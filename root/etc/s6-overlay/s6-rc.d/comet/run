#!/command/with-contenv

# Wait for Prowlarr to be ready
echo "Waiting for Prowlarr at http://127.0.0.1:9696..."
until curl -s http://127.0.0.1:9696 > /dev/null; do
  sleep 2
done
echo "Prowlarr is up. Starting Comet..."

# Start Comet
cd /app/comet
# FORCE unbuffered output so logs appear instantly
export PYTHONUNBUFFERED=1
# FORCE binding to 0.0.0.0 via command line args if possible, or env vars
export FASTAPI_HOST=0.0.0.0
export FASTAPI_PORT=8000

# CRITICAL FIX: Use the new official startup method with uv
# This matches the latest Comet installation instructions
exec uv run python -m comet.main